<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام محاسبي متقدم</title>
    
    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Cairo -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/animations.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/print.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Header مستوحى من التصميم الحكومي -->
    <header class="main-header">
        <div class="header-container">
            <div class="header-logo">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="شعار الشركة" class="company-logo">
            </div>
            <div class="header-content">
                <div class="program-name">
                    <div>شركة الأصدقاء للتخليص الكمركي</div>
                    <div style="font-size: 20px; margin-top: 8px;">نظام إدارة الحسابات والشراكة المتقدم</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Entry Form -->
            <div class="form-card">
                <div class="form-header">
                    <h3><i class="fas fa-plus-circle"></i> إضافة سجل جديد</h3>
                </div>
                <form id="mainForm" class="entry-form">
                    <div class="form-grid">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">اسم التاجر المرسل *</label>
                                <input type="text" class="form-control" id="merchantName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">اسم السائق الأجنبي</label>
                                <input type="text" class="form-control" id="foreignDriver">
                            </div>
                            <div class="form-group">
                                <label class="form-label">رقم سيارة الأجنبي</label>
                                <input type="text" class="form-control" id="foreignCar">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">اسم السائق المحلي</label>
                                <input type="text" class="form-control" id="localDriver">
                            </div>
                            <div class="form-group">
                                <label class="form-label">رقم سيارة المحلي</label>
                                <input type="text" class="form-control" id="localCar">
                            </div>
                            <div class="form-group">
                                <label class="form-label">التاريخ *</label>
                                <input type="date" class="form-control" id="date" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label class="form-label">نوع البضاعة</label>
                                <input type="text" class="form-control" id="goodsType">
                            </div>
                        </div>
                        
                        <div class="form-row financial-row">
                            <div class="form-group">
                                <label class="form-label">الرسوم (دين في ذمتي للتاجر) $</label>
                                <input type="number" class="form-control financial-input" id="fees" value="0" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">السلف (دين في ذمتي للتاجر) $</label>
                                <input type="number" class="form-control financial-input" id="advance" value="0" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">كلفة التخليص $</label>
                                <input type="number" class="form-control financial-input" id="myProfit" value="0" min="0" step="0.01">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">الإضافة $</label>
                                <input type="number" class="form-control financial-input" id="addition" value="0" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">الراجع $</label>
                                <input type="number" class="form-control financial-input" id="returned" value="0" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">الملاحظات</label>
                                <input type="text" class="form-control" id="notes" placeholder="إضافة ملاحظات...">
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save"></i> حفظ السجل
                        </button>
                    </div>
                </form>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons wave-effect">
                <button type="button" class="btn btn-info interactive-element star-effect" onclick="openRecords()">
                    <i class="fas fa-list"></i> سجلات الإدخالات
                </button>
                <button type="button" class="btn btn-warning interactive-element star-effect" onclick="openMerchantsDebts()">
                    <i class="fas fa-users"></i> ديون التجار
                </button>

                <button type="button" class="btn btn-success interactive-element star-effect" onclick="openMerchantStatement()">
                    <i class="fas fa-file-invoice"></i> كشف حساب تاجر
                </button>
                <button type="button" class="btn btn-danger interactive-element star-effect" onclick="openWithdrawal()">
                    <i class="fas fa-money-bill-wave"></i> السحوبات الخارجية
                </button>
                <button type="button" class="btn btn-primary interactive-element star-effect" onclick="openPartnersManagement()">
                    <i class="fas fa-handshake"></i> إدارة الشراكة
                </button>

            </div>


        </div>
    </main>

    <!-- Modals -->
    
    <!-- Records Modal -->
    <div class="modal fade" id="recordsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-list"></i> سجلات الإدخالات</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="print-header" style="display: none;">
                        <h3>شركة الأصدقاء للتخليص الكمركي</h3>
                        <h4>سجلات الإدخالات</h4>
                    </div>
                    <div class="print-date" style="display: none;">
                        تاريخ الطباعة: <span id="printDate"></span>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>التاريخ</th>
                                    <th>التاجر</th>
                                    <th>نوع البضاعة</th>
                                    <th>الرسوم</th>
                                    <th>السلف</th>
                                    <th>التخليص</th>
                                    <th>الإضافة</th>
                                    <th>الراجع</th>
                                    <th>إجمالي الدين</th>
                                    <th>صافي الربح</th>
                                </tr>
                            </thead>
                            <tbody id="recordsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="printRecords()">
                        <i class="fas fa-print"></i> طباعة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Merchants Debts Modal -->
    <div class="modal fade" id="merchantsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-users"></i> ديون التجار</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="print-header" style="display: none;">
                        <h3>شركة الأصدقاء للتخليص الكمركي</h3>
                        <h4>ديون التجار</h4>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>اسم التاجر</th>
                                    <th>عدد المعاملات</th>
                                    <th>إجمالي الرسوم</th>
                                    <th>إجمالي السلف</th>
                                    <th>إجمالي الديون</th>
                                    <th>إجمالي المدفوعات</th>
                                    <th>الرصيد الحالي</th>
                                    <th>آخر معاملة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="merchantsDebtsBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="printMerchants()">
                        <i class="fas fa-print"></i> طباعة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Merchant Statement Modal -->
    <div class="modal fade" id="merchantStatementModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-file-invoice"></i> كشف حساب تاجر</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">اختر التاجر</label>
                            <select class="form-control" id="merchantSelect" onchange="loadMerchantStatement()">
                                <option value="">-- اختر التاجر --</option>
                            </select>
                        </div>
                    </div>

                    <div id="merchantStatementContent" style="display: none;">
                        <div class="print-header" style="display: none;">
                            <h3>شركة الأصدقاء للتخليص الكمركي</h3>
                            <h4>كشف حساب التاجر: <span id="merchantStatementNamePrint"></span></h4>
                        </div>

                        <div class="merchant-header">
                            <h4>كشف حساب التاجر: <span id="merchantStatementName"></span></h4>
                            <div class="balance-card">
                                <strong>الرصيد الحالي: <span id="merchantCurrentBalance"></span></strong>
                            </div>
                        </div>

                        <!-- معاملات التاجر -->
                        <h5><i class="fas fa-list"></i> المعاملات</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>التاريخ</th>
                                        <th>نوع البضاعة</th>
                                        <th>التخليص</th>
                                        <th>الرسوم</th>
                                        <th>السلف</th>
                                        <th>الإضافة</th>
                                        <th>الراجع</th>
                                        <th>إجمالي الدين</th>
                                    </tr>
                                </thead>
                                <tbody id="merchantTransactionsBody">
                                </tbody>
                            </table>
                        </div>

                        <!-- تسديدات التاجر -->
                        <h5><i class="fas fa-money-bill"></i> التسديدات</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>تاريخ التسديد</th>
                                        <th>المبلغ</th>
                                        <th>الرصيد قبل</th>
                                        <th>الرصيد بعد</th>
                                        <th>الملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody id="merchantPaymentsBody">
                                </tbody>
                            </table>
                        </div>

                        <!-- إضافة تسديد جديد -->
                        <div class="payment-form-section no-print">
                            <h5><i class="fas fa-plus"></i> إضافة تسديد جديد</h5>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">مبلغ التسديد $</label>
                                    <input type="number" class="form-control" id="paymentAmount" min="0" step="0.01">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">تاريخ التسديد</label>
                                    <input type="date" class="form-control" id="paymentDate">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">ملاحظات</label>
                                    <input type="text" class="form-control" id="paymentNotes">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="button" class="btn btn-success w-100" onclick="addPayment()">
                                        <i class="fas fa-plus"></i> إضافة
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- الإضافات والإرجاعات -->
                        <div class="adjustment-section no-print mt-4">
                            <h5><i class="fas fa-edit text-warning"></i> الإضافات والإرجاعات</h5>
                            
                            <!-- جدول التعديلات الموجودة -->
                            <div class="table-responsive mb-3">
                                <table class="table table-striped table-sm">
                                    <thead class="table-warning">
                                        <tr>
                                            <th>التاريخ</th>
                                            <th>النوع</th>
                                            <th>المبلغ</th>
                                            <th>الوصف</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="merchantAdjustmentsBody">
                                        <!-- سيتم تحميل التعديلات هنا -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- إضافة تعديل جديد -->
                            <div class="adjustment-form bg-light p-3 rounded">
                                <h6><i class="fas fa-plus-circle"></i> إضافة تعديل جديد</h6>
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label">نوع التعديل</label>
                                        <select class="form-control" id="adjustmentType">
                                            <option value="">اختر النوع...</option>
                                            <option value="addition">إضافة (تقليل الدين)</option>
                                            <option value="return">إرجاع (زيادة الدين)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">المبلغ $</label>
                                        <input type="number" class="form-control" id="adjustmentAmount" min="0" step="0.01">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">التاريخ</label>
                                        <input type="date" class="form-control" id="adjustmentDate">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">الوصف</label>
                                        <input type="text" class="form-control" id="adjustmentDescription" placeholder="وصف التعديل">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">&nbsp;</label>
                                        <button type="button" class="btn btn-warning w-100" onclick="addMerchantAdjustment()">
                                            <i class="fas fa-save"></i> حفظ
                                        </button>
                                    </div>
                                </div>
                                <div class="row g-3 mt-2">
                                    <div class="col-12">
                                        <label class="form-label">ملاحظات إضافية</label>
                                        <textarea class="form-control" id="adjustmentNotes" rows="2" placeholder="ملاحظات اختيارية"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ملخص مالي -->
                        <div class="row mt-4">
                            <div class="col-md-4">
                                <div class="summary-card">
                                    <h6>إجمالي التخليص</h6>
                                    <p>$<span id="totalClearance">0.00</span></p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="summary-card">
                                    <h6>إجمالي الأجور</h6>
                                    <p>$<span id="totalFees">0.00</span></p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="summary-card">
                                    <h6>إجمالي السلف</h6>
                                    <p>$<span id="totalAdvance">0.00</span></p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="summary-card">
                                    <h6>إجمالي الديون</h6>
                                    <p>$<span id="totalDebts">0.00</span></p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="summary-card">
                                    <h6>إجمالي المدفوعات</h6>
                                    <p>$<span id="totalPayments">0.00</span></p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="summary-card">
                                    <h6>الرصيد النهائي</h6>
                                    <p>$<span id="currentBalance">0.00</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="printMerchantStatement()">
                        <i class="fas fa-print"></i> طباعة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div class="modal fade" id="withdrawModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-money-bill-wave"></i> السحوبات الخارجية</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="print-header" style="display: none;">
                        <h3>شركة الأصدقاء للتخليص الكمركي</h3>
                        <h4>السحوبات الخارجية</h4>
                    </div>

                    <!-- نموذج إضافة السحب -->
                    <div class="withdrawal-form-section no-print">
                        <h5><i class="fas fa-plus"></i> إضافة سحب جديد</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <label class="form-label">مبلغ السحب $</label>
                                <input type="number" class="form-control" id="withdrawAmount" min="0" step="0.01">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">تاريخ السحب</label>
                                <input type="date" class="form-control" id="withdrawDate">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">الوصف</label>
                                <input type="text" class="form-control" id="withdrawDescription">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">&nbsp;</label>
                                <button type="button" class="btn btn-danger w-100" onclick="addWithdrawal()">
                                    <i class="fas fa-plus"></i> إضافة
                                </button>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">ملاحظات</label>
                                <textarea class="form-control" id="withdrawNotes" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- معلومات الرصيد -->
                    <div class="balance-card mb-4">
                        <h5>الرصيد المتاح للسحب: <span id="availableForWithdraw">${{ "%.2f"|format(stats.available_balance) }}</span></h5>
                    </div>

                    <!-- قائمة السحوبات -->
                    <h5><i class="fas fa-list"></i> السحوبات السابقة</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>التاريخ</th>
                                    <th>المبلغ</th>
                                    <th>الوصف</th>
                                    <th>الملاحظات</th>
                                    <th class="no-print">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="withdrawalsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="printWithdrawals()">
                        <i class="fas fa-print"></i> طباعة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Partners Management Modal -->
    <div class="modal fade" id="partnersModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-xxl-down">
            <div class="modal-content partners-modal">
                <div class="modal-header gradient-header">
                    <h5 class="modal-title text-white">
                        <i class="fas fa-handshake me-2"></i>
                        مركز إدارة الشراكة المتقدم
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body partners-dashboard">
                    <div class="print-header" style="display: none;">
                        <h3>شركة الأصدقاء للتخليص الكمركي</h3>
                        <h4>تقرير إدارة الشراكة الشامل</h4>
                    </div>

                    <!-- Dashboard Header -->
                    <div class="dashboard-header mb-4">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="welcome-card">
                                    <h3 class="dashboard-title">
                                        <i class="fas fa-chart-line text-primary"></i>
                                        لوحة تحكم الشراكة
                                    </h3>
                                    <p class="text-muted">إدارة شاملة لحسابات وأرباح الشركاء</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="action-quick-buttons">
                                    <button class="btn btn-outline-primary btn-sm" onclick="updateProfitStats()">
                                        <i class="fas fa-sync-alt"></i> تحديث البيانات
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" onclick="printPartnersReport()">
                                        <i class="fas fa-print"></i> طباعة التقرير
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Key Metrics Cards -->
                    <div class="row metrics-cards mb-4">
                        <div class="col-md-3">
                            <div class="metric-card partners-balance">
                                <div class="metric-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="metric-content">
                                    <h6>إجمالي أرصدة الشركاء</h6>
                                    <p class="metric-value" id="totalPartnersBalance">$0.00</p>
                                    <small class="text-muted">الرصيد الإجمالي</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card active-partners">
                                <div class="metric-icon">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div class="metric-content">
                                    <h6>الشركاء النشطون</h6>
                                    <p class="metric-value" id="activePartnersCount">8</p>
                                    <small class="text-muted">شريك نشط</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card available-profits">
                                <div class="metric-icon">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <div class="metric-content">
                                    <h6>الأرباح المتاحة للتوزيع</h6>
                                    <p class="metric-value" id="availableNetProfits">$0.00</p>
                                    <small class="text-muted">جاهزة للتوزيع</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card distributed-profits">
                                <div class="metric-icon">
                                    <i class="fas fa-share-alt"></i>
                                </div>
                                <div class="metric-content">
                                    <h6>الأرباح الموزعة</h6>
                                    <p class="metric-value" id="totalDistributedProfits">$0.00</p>
                                    <small class="text-muted">إجمالي التوزيعات</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profit Distribution Section -->
                    <div class="section-card profit-distribution-section mb-4">
                        <div class="section-header">
                            <h5><i class="fas fa-chart-pie text-warning"></i> مركز توزيع الأرباح</h5>
                            <div class="section-actions">
                                <span class="badge bg-info">نظام التوزيع الذكي</span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- Auto Distribution -->
                            <div class="col-md-6">
                                <div class="distribution-card auto-distribution">
                                    <div class="card-header">
                                        <h6><i class="fas fa-magic text-warning"></i> التوزيع التلقائي</h6>
                                        <span class="badge bg-warning">ذكي</span>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">توزيع تلقائي للأرباح الصافية حسب النسب المحددة</p>
                                        <div class="profit-info">
                                            <div class="profit-amount">
                                                <span>الأرباح المتاحة:</span>
                                                <strong id="autoDistributionAmount">$0.00</strong>
                                            </div>
                                        </div>
                                        <button class="btn btn-warning btn-lg w-100 distribution-btn" onclick="distributeAutoProfit()">
                                            <i class="fas fa-magic"></i> توزيع تلقائي فوري
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Manual Distribution -->
                            <div class="col-md-6">
                                <div class="distribution-card manual-distribution">
                                    <div class="card-header">
                                        <h6><i class="fas fa-hand-paper text-success"></i> التوزيع اليدوي</h6>
                                        <span class="badge bg-success">مخصص</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <label class="form-label text-sm">المبلغ $</label>
                                                <input type="number" class="form-control form-control-sm financial-input" 
                                                       id="profitToDistribute" value="0" min="0" step="0.01" 
                                                       placeholder="أدخل المبلغ">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label text-sm">التاريخ</label>
                                                <input type="date" class="form-control form-control-sm" id="distributionDate">
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label text-sm">وصف التوزيع</label>
                                                <input type="text" class="form-control form-control-sm" 
                                                       id="distributionDescription" value="توزيع أرباح شهرية">
                                            </div>
                                        </div>
                                        <button class="btn btn-success btn-lg w-100 mt-3 distribution-btn" onclick="distributeManualProfit()">
                                            <i class="fas fa-share-alt"></i> توزيع يدوي مخصص
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Partner Transaction Section -->
                    <div class="section-card transaction-section mb-4 no-print">
                        <div class="section-header">
                            <h5><i class="fas fa-exchange-alt text-primary"></i> إدارة معاملات الشركاء</h5>
                            <div class="section-actions">
                                <span class="badge bg-primary">معاملات فورية</span>
                            </div>
                        </div>
                        
                        <div class="transaction-form">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">اختر الشريك</label>
                                    <select class="form-select" id="selectedPartnerId">
                                        <option value="">-- اختر الشريك --</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">نوع المعاملة</label>
                                    <select class="form-select" id="partnerTransactionType">
                                        <option value="add">💰 إيداع</option>
                                        <option value="withdraw">💸 سحب</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">المبلغ $</label>
                                    <input type="number" class="form-control financial-input" 
                                           id="partnerTransactionAmount" value="0" min="0" step="0.01">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">التاريخ</label>
                                    <input type="date" class="form-control" id="partnerTransactionDate">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">الوصف</label>
                                    <input type="text" class="form-control" id="partnerTransactionDescription" 
                                           placeholder="وصف المعاملة">
                                </div>
                                <div class="col-md-9">
                                    <label class="form-label">ملاحظات إضافية</label>
                                    <input type="text" class="form-control" id="partnerTransactionNotes" 
                                           placeholder="ملاحظات اختيارية">
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <button class="btn btn-primary btn-lg w-100" onclick="addPartnerTransaction()">
                                        <i class="fas fa-plus"></i> تنفيذ المعاملة
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Partners Table -->
                    <div class="section-card partners-table-section">
                        <div class="section-header">
                            <h5><i class="fas fa-table text-info"></i> جدول حسابات الشركاء</h5>
                            <div class="section-actions">
                                <span class="badge bg-info">تحديث تلقائي</span>
                            </div>
                        </div>
                        
                        <div class="table-responsive partners-table">
                            <table class="table table-hover table-striped">
                                <thead class="table-dark">
                                    <tr>
                                        <th><i class="fas fa-user"></i> اسم الشريك</th>
                                        <th><i class="fas fa-percentage"></i> نسبة الربح</th>
                                        <th><i class="fas fa-arrow-up text-success"></i> إجمالي الأرباح</th>
                                        <th><i class="fas fa-arrow-down text-danger"></i> إجمالي السحوبات</th>
                                        <th><i class="fas fa-balance-scale"></i> الرصيد الحالي</th>
                                        <th><i class="fas fa-list-ol"></i> عدد المعاملات</th>
                                        <th class="no-print"><i class="fas fa-cog"></i> الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="partnersTableBody">
                                    <!-- سيتم ملء البيانات هنا تلقائياً -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="printPartnersReport()">
                        <i class="fas fa-print"></i> طباعة تقرير الشركاء
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Partner Statement Modal -->
    <div class="modal fade" id="partnerStatementModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user"></i> كشف حساب الشريك</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="partner-header text-center mb-4">
                        <h4 id="partnerStatementName">اسم الشريك</h4>
                        <div class="balance-card">
                            الرصيد الحالي: <span id="partnerCurrentBalance">$0.00</span>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>التاريخ</th>
                                    <th>نوع المعاملة</th>
                                    <th>المبلغ</th>
                                    <th>الوصف</th>
                                    <th>الرصيد التراكمي</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="partnerStatementBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" onclick="printPartnerStatement()">
                        <i class="fas fa-print"></i> طباعة كشف الحساب
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

    <!-- Footer مستوحى من التصميم الحكومي -->
    <footer class="designer-info">
        <strong>نظام محاسبي متقدم لشركة الأصدقاء للتخليص الكمركي</strong><br>
        تم تصميم وبرمجة النظام بواسطة: <strong>فريق التطوير المتخصص</strong><br>
        Email: <a href="mailto:info@friends-customs.com">info@friends-customs.com</a> | 
        Phone: <a href="tel:+9647xxxxxxxx">+964 7XX XXX XXXX</a><br>
        🔹 هذا النظام مدعوم بتقنيات حديثة لإدارة الحسابات 🔹
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Sounds JS -->
    <script src="{{ url_for('static', filename='js/sounds.js') }}"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
